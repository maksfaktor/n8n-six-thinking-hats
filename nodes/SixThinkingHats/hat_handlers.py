class HatHandler:
    def __init__(self, client):
        self.client = client
        self.hat_prompts = {
            'white': """
                Анализируйте следующую тему с позиции Белой шляпы (только факты и информация):
                Тема: {topic}
                Сосредоточьтесь на:
                - Доступных данных и фактах
                - Объективной информации
                - Пробелах в знаниях
                Пожалуйста, предоставьте структурированный анализ фактов.
            """,
            'red': """
                Рассмотрите следующую тему с позиции Красной шляпы (эмоции и чувства):
                Тема: {topic}
                Сосредоточьтесь на:
                - Эмоциональных реакциях
                - Интуитивных ответах
                - Внутренних ощущениях
                Поделитесь эмоциональной перспективой без обоснования.
            """,
            'black': """
                Оцените следующую тему с позиции Черной шляпы (критическое суждение):
                Тема: {topic}
                Сосредоточьтесь на:
                - Потенциальных рисках
                - Логических недостатках
                - Слабых местах
                Предоставьте тщательный критический анализ.
            """,
            'yellow': """
                Изучите следующую тему с позиции Желтой шляпы (преимущества и позитив):
                Тема: {topic}
                Сосредоточьтесь на:
                - Возможностях
                - Преимуществах
                - Позитивных аспектах
                Перечислите конструктивные моменты и потенциальные выгоды.
            """,
            'green': """
                Рассмотрите следующую тему с позиции Зеленой шляпы (креативность):
                Тема: {topic}
                Сосредоточьтесь на:
                - Новых идеях
                - Альтернативных подходах
                - Инновационных решениях
                Создайте творческие возможности и альтернативы.
            """,
            'blue': """
                Организуйте мысли о следующей теме с позиции Синей шляпы (контроль процесса):
                Тема: {topic}
                Сосредоточьтесь на:
                - Обзоре процесса мышления
                - Следующих шагах
                - Пунктах для действия
                Предоставьте структурированное резюме и план действий.
            """
        }

    def process_hat(self, hat_color, topic):
        if hat_color not in self.hat_prompts:
            return {"error": f"Неверный цвет шляпы: {hat_color}"}

        prompt_template = self.hat_prompts[hat_color]
        formatted_prompt = prompt_template.format(topic=topic)

        # the newest Anthropic model is "claude-3-5-sonnet-20241022" which was released October 22, 2024
        response = self.client.messages.create(
            model="claude-3-5-sonnet-20241022",
            max_tokens=1000,
            messages=[{"role": "user", "content": formatted_prompt}]
        )

        return {
            "analysis": response.content[0].text.strip(),
            "hat_color": hat_color
        }